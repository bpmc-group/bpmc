{% extends "administration/admin_std_template.html" %}

<title>{% block title %}Add User{% endblock %}</title>

{% block content %}
    <!-- Top Bar -->
    <div class="top-bar">
        <span>Add User</span>
        <a href="http://127.0.0.1:8000/auth/home/" class="home-icon">&#x2302; Home</a>       
    </div>

    <!-- Main Content -->
    <div class="container content">
        <h3>Add User</h3>
        <form id="addUserForm" method="POST" action="/api/users/create/">
            {% csrf_token %}
            
            <!-- First Name -->
            <div class="mb-3">
                <label for="first_name" class="form-label">First Name</label>
                <input type="text" class="form-control" id="first_name" name="first_name">
            </div>

            <!-- Last Name -->
            <div class="mb-3">
                <label for="last_name" class="form-label">Last Name</label>
                <input type="text" class="form-control" id="last_name" name="last_name">
            </div>

            <!-- Employee Full Name -->
            <div class="mb-3">
                <label for="employee_full_name" class="form-label">Employee Full Name</label>
                <input type="text" class="form-control" id="employee_full_name" name="employee_full_name">
            </div>

            <!-- Hire Date -->
            <div class="mb-3">
                <label for="hire_date" class="form-label">Hire Date</label>
                <input type="date" class="form-control" id="hire_date" name="hire_date">
            </div>

            <!-- Employment Status -->
            <div class="mb-3">
                <label for="employment_status" class="form-label">Employment Status</label>
                <input type="text" class="form-control" id="employment_status" name="employment_status">
            </div>

            <!-- Username -->
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" class="form-control" id="username" name="username">
            </div>

            <!-- User Status -->
            <div class="mb-3">
                <label for="user_status" class="form-label">User Status</label>
                <input type="text" class="form-control" id="user_status" name="user_status">
            </div>

            <!-- Primary Job -->
            <div class="mb-3">
                <label for="primary_job" class="form-label">Primary Job</label>
                <input type="text" class="form-control" id="primary_job" name="primary_job">
            </div>

            <!-- Department Number -->
            <div class="mb-3">
                <label for="department_number" class="form-label">Department Number</label>
                <input type="text" class="form-control" id="department_number" name="department_number">
            </div>

            <!-- Department Description -->
            <div class="mb-3">
                <label for="department_description" class="form-label">Department Description</label>
                <input type="text" class="form-control" id="department_description" name="department_description">
            </div>

            <!-- Reports To -->
            <div class="mb-3">
                <label for="reports_to" class="form-label">Reports To</label>
                <input type="text" class="form-control" id="reports_to" name="reports_to">
            </div>

            <!-- Reports To Employee ID -->
            <div class="mb-3">
                <label for="reports_to_employee_id" class="form-label">Reports To Employee ID</label>
                <input type="text" class="form-control" id="reports_to_employee_id" name="reports_to_employee_id">
            </div>

            <!-- Email -->
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>

            <!-- Password -->
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" id="password" name="password" required>
            </div>

            <!-- Phone Numbers -->
            <div class="mb-3">
                <label for="phone_number_1" class="form-label">Phone Number 1</label>
                <input type="text" class="form-control" id="phone_number_1" name="phone_number_1">
            </div>
            <div class="mb-3">
                <label for="phone_number_2" class="form-label">Phone Number 2</label>
                <input type="text" class="form-control" id="phone_number_2" name="phone_number_2">
            </div>
            <div class="mb-3">
                <label for="phone_number_3" class="form-label">Phone Number 3</label>
                <input type="text" class="form-control" id="phone_number_3" name="phone_number_3">
            </div>

            <!-- Pay Rule -->
            <div class="mb-3">
                <label for="pay_rule" class="form-label">Pay Rule</label>
                <input type="text" class="form-control" id="pay_rule" name="pay_rule">
            </div>

            <!-- Hourly Wage Rate -->
            <div class="mb-3">
                <label for="hourly_wage_rate" class="form-label">Hourly Wage Rate</label>
                <input type="number" step="0.01" class="form-control" id="hourly_wage_rate" name="hourly_wage_rate">
            </div>

            <!-- Worker Type -->
            <div class="mb-3">
                <label for="worker_type" class="form-label">Worker Type</label>
                <input type="text" class="form-control" id="worker_type" name="worker_type">
            </div>

            <!-- Schedule Group Name -->
            <div class="mb-3">
                <label for="schedule_group_name" class="form-label">Schedule Group Name</label>
                <input type="text" class="form-control" id="schedule_group_name" name="schedule_group_name">
            </div>

            <!-- Accrual Profile Name -->
            <div class="mb-3">
                <label for="accrual_profile_name" class="form-label">Accrual Profile Name</label>
                <input type="text" class="form-control" id="accrual_profile_name" name="accrual_profile_name">
            </div>

            <!-- Badge Number -->
            <div class="mb-3">
                <label for="badge_number" class="form-label">Badge Number</label>
                <input type="text" class="form-control" id="badge_number" name="badge_number">
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary w-100 mt-3">Add User</button>
        </form>

        <div id="notifications"></div>
    </div>

    <script>
        // Toggle visibility of collapsible sections
        function toggleSection(header) {
            const section = header.parentElement;
            section.classList.toggle('open');
        }

        // Form submission handling
        document.getElementById("addUserForm").addEventListener("submit", async function (event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            const notificationsContainer = document.getElementById("notifications");
            notificationsContainer.innerHTML = "";

            try {
                const response = await fetch('/api/users/create/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify(data),
                });

                if (response.ok) {
                    notificationsContainer.innerHTML = `
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            User created successfully!
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    `;
                    form.reset();
                } else {
                    const errorData = await response.json();
                    notificationsContainer.innerHTML = `
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            Error: ${JSON.stringify(errorData)}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    `;
                }
            } catch (error) {
                notificationsContainer.innerHTML = `
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        An unexpected error occurred. Please try again.
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                `;
            }
        });
    </script>
{% endblock %}

